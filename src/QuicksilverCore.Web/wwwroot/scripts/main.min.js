var addressDropDown;var AddressBook={init:function(){$(document).on("change",".jsChangeCountry",AddressBook.setRegion);$(document).on("click",".save-address-ajax-button",AddressBook.saveNewAddress)},setRegion:function(){var $countryCode=$(this).val();var $addressRegionContainer=$(".address-region",$(this).parents().eq(1));var $region=$(".address-region-input",$addressRegionContainer).val();var $htmlPrefix=$("input[name='address-htmlfieldprefix']",$(this).parent()).val();var $url="/AddressBook/GetRegionsForCountry/";$.ajax({type:"POST",url:$url,data:{countryCode:$countryCode,region:$region,htmlPrefix:$htmlPrefix},success:function(result){$addressRegionContainer.replaceWith($(result))}})},showNewAddressDialog:function(sender){addressDropDown=$(sender).siblings(".address-dropdown");var url=$(sender).data("url");$.ajax({type:"GET",cache:false,url:url,success:function(result){AddressBook.setAddressFormAsModalContent(result)}})},setAddressFormAsModalContent:function(view){$("#AddressDialogContent").html($(view));$('button[type="submit"]',$("#AddressDialog")).addClass("save-address-ajax-button")},saveNewAddress:function(e){e.preventDefault();var form=$(this).closest("form");$.ajax({type:"POST",cache:false,url:form[0].action,data:form.serialize(),success:function(result){if(result.AddressId){$(".address-dropdown").each(function(){$('option[value=""]',this).remove()});var option=$("<option>");option.attr("value",result.AddressId).text(result.Name);$(".address-dropdown").append(option);$("#AddressDialog").modal("hide");if(addressDropDown){addressDropDown.val(result.AddressId)}$(".address-dropdown").each(function(){Checkout.changeTaxAddress($(this))});return}AddressBook.setAddressFormAsModalContent(result)}})}};var Cart={init:function(){$(document).on("keypress",".jsChangeCartItem",Cart.preventSubmit).on("click",".jsRemoveCartItem",Cart.removeCartItem).on("change",".jsChangeCartItem",Cart.changeCartItem).on("change",".jsChangeShipment",Cart.changeShipment).on("click",".jsAddToCart",Cart.addCartItem).on("change","#MiniCart",function(){$("#MiniCartResponsive > div:first").html($("div:first",this).html())}).on("change","#WishListMiniCart",function(){$("#WishListMiniCartResponsive > div:first").html($("div:first",this).html())}).on("click",".jsCartContinueShopping",function(){if($(this).closest("#cart-dropdown")){$(this).closest("#cart-dropdown").collapse("hide")}}).on("click",".jsWishListContinueShopping",function(){if($(this).closest("#wishlist-dropdown")){$(this).closest("#wishlist-dropdown").collapse("hide")}}).on("click",".jsCartDropdown",function(e){return $(e.target).hasClass("btn")||$(e.target).parent().is("a")});$(".cart-dropdown").on("show.bs.dropdown",function(e){if($("#CartItemCount",$(this)).val()===0){e.preventDefault()}})},changeShipment:function(){var container=$(this).closest(".shipping-method");var url=container.data("url");$.ajax({type:"POST",url:url,cache:false,success:function(result){Checkout.updateOrderSummary()}})},changeCartItem:function(e){e.preventDefault();var form=$(this).closest("form");var quantity=$("#quantity",form).val();if(parseInt(quantity,10)<0){return}var formContainer=$("#"+form.data("container"));$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(result){formContainer.html($(result));$(".cartItemCountLabel",formContainer.parent()).text($("#CartItemCount",formContainer).val());$(".cartTotalAmountLabel",formContainer.parent()).text($("#CartTotalAmount",formContainer).val());if(formContainer.is($("#WishListMiniCart"))){if(result.indexOf("list-group-item")===-1){$(".delete-wishlist").hide()}var wishListAction=form.closest(".wishlist-actions");if(wishListAction.length>0){wishListAction.parent().remove()}}}})},removeCartItem:function(e){e.preventDefault();var form=$(this).closest("form");$("#quantity",form).val(0).change();$(this).closest(".jsProductTile").remove();if(!$(".jsProductTile").length){$(".wishlist-noitem").show()}},addCartItem:function(e){e.preventDefault();var form=$(this).closest("form");var formContainer=$("#"+form.data("container"));var skuCode=$("#code",form).val();$("#CartWarningMessage").hide();$(".warning-message",$("#CartWarningMessage")).html("");$.ajax({type:"POST",url:form[0].action,data:{code:skuCode},success:function(result){formContainer.html($(result));$(".cartItemCountLabel",formContainer.parent()).text($("#CartItemCount",formContainer).val());$(".cartTotalAmountLabel",formContainer.parent()).text($("#CartTotalAmount",formContainer).val());formContainer.change()},error:function(xhr,status,error){$(".warning-message",$("#CartWarningMessage")).html(xhr.statusText);$("#CartWarningMessage").show()}})},preventSubmit:function(e){if(e.keyCode===13){e.preventDefault()}}};var Checkout={init:function(){$(document).on("change",".jsChangePayment",Checkout.changePayment).on("change",".jsChangeAddress",Checkout.changeAddress).on("change",".jsChangeTaxAddress",Checkout.changeTaxAddress).on("change","#MiniCart",Checkout.refreshView).on("change","#MiniCartResponsive",Checkout.refreshView).on("change","#CheckoutView .jsChangeCartItem",Checkout.refreshView).on("click",".jsNewAddress",Checkout.newAddress).on("click","#AlternativeAddressButton",Checkout.enableShippingAddress).on("click",".remove-shipping-address",Checkout.removeShippingAddress).on("click",".js-add-couponcode",Checkout.addCouponCode).on("click",".js-remove-couponcode",Checkout.removeCouponCode);Checkout.initializeAddressAreas()},initializeAddressAreas:function(){if($("#UseBillingAddressForShipment").val()=="False"){Checkout.doEnableShippingAddress()}else{Checkout.doRemoveShippingAddress()}},addCouponCode:function(e){e.preventDefault();var couponCode=$(inputCouponCode).val();if(couponCode.trim()){$.ajax({type:"POST",url:$(this).data("url"),data:{couponCode:couponCode},success:function(result){if(!result){$(".couponcode-errormessage").show();return}$(".couponcode-errormessage").hide();$("#CheckoutView").replaceWith($(result));Checkout.initializeAddressAreas()}})}},removeCouponCode:function(e){e.preventDefault();$.ajax({type:"POST",url:$(this).attr("href"),data:{couponCode:$(this).siblings().text()},success:function(result){$("#CheckoutView").replaceWith($(result));Checkout.initializeAddressAreas()}})},refreshView:function(){var view=$("#CheckoutView");if(view.length==0){return}var url=view.data("url");$.ajax({cache:false,type:"GET",url:view.data("url"),success:function(result){view.replaceWith($(result));Checkout.initializeAddressAreas()}})},newAddress:function(e){e.preventDefault();AddressBook.showNewAddressDialog($(this))},changeAddress:function(){var form=$(".jsCheckoutForm");var id=$(this).attr("id");var isBilling=id.indexOf("Billing")>-1;if(isBilling){$("#ShippingAddressIndex").val(-1)}else{$("#ShippingAddressIndex").val($(".jsChangeAddress").index($(this))-1)}$.ajax({type:"POST",cache:false,url:$(this).closest(".jsCheckoutAddress").data("url"),data:form.serialize(),success:function(result){if(isBilling){$("#billingAddressContainer").html($(result))}else{$("#AddressContainer").html($(result))}Checkout.initializeAddressAreas();Checkout.updateOrderSummary()}})},changeTaxAddress:function(sender){if(sender.originalEvent instanceof Event){sender=$(this)}var id=$(sender).attr("id");if(id.indexOf("Billing")>-1&&$("#UseBillingAddressForShipment").val()=="False"){return}var form=$(".jsCheckoutForm");if(form.length==0){return}$.ajax({type:"POST",cache:false,url:$(sender).closest(".jsCheckoutAddress").data("url"),data:form.serialize(),success:function(result){Checkout.updateOrderSummary()}})},changePayment:function(){$.ajax({type:"POST",url:$(this).data("url"),success:function(result){$(".jsPaymentMethod").replaceWith($(result).find(".jsPaymentMethod"));Checkout.updateOrderSummary();Misc.updateValidation("jsCheckoutForm")}})},updateOrderSummary:function(){$.ajax({cache:false,type:"GET",url:$(".jsOrderSummary").data("url"),success:function(result){$(".jsOrderSummary").replaceWith($(result).filter(".jsOrderSummary"))}})},doEnableShippingAddress:function(){$("#AlternativeAddressButton").hide();$(".shipping-address:hidden").slideToggle(300);$(".shipping-address").css("display","block");$("#UseBillingAddressForShipment").val("False")},enableShippingAddress:function(event){event.preventDefault();Checkout.doEnableShippingAddress();var form=$(".jsCheckoutForm");$("#ShippingAddressIndex").val(0);$.ajax({type:"POST",cache:false,url:$(".jsCheckoutAddress").data("url"),data:form.serialize(),success:function(result){$("#AddressContainer").html($(result));Checkout.initializeAddressAreas();Checkout.updateOrderSummary()}})},doRemoveShippingAddress:function(){$("#AlternativeAddressButton").show();$(".shipping-address:visible").slideToggle(300);$(".shipping-address").css("display","none");$("#UseBillingAddressForShipment").val("True")},removeShippingAddress:function(event){event.preventDefault();Checkout.doRemoveShippingAddress();var form=$(".jsCheckoutForm");$("#ShippingAddressIndex").val(-1);$.ajax({type:"POST",cache:false,url:$(".jsCheckoutAddress").data("url"),data:form.serialize(),success:function(result){Checkout.initializeAddressAreas();Checkout.updateOrderSummary()}})}};var login={init:function(){$(document).on("submit",".jsLoginBlock",login.login)},login:function(e){e.preventDefault();var form=$(this).closest(".jsLoginBlock");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(response,status,xhr){var ct=xhr.getResponseHeader("content-type")||"";if(ct.indexOf("html")>-1){$(form).closest(".jsLoginBlockWrapper").replaceWith($(response))}if(ct.indexOf("json")>-1){document.location=response.ReturnUrl}}})}};var Market={init:function(){$(document).on("change ",".jsMarketSelector",Market.setMarket).on("change ",".jsLanguageSelector",Market.setLanguage).on("change ",".jsCurrencySelector",Market.setCurrency)},setMarket:function(){var form=$(this).closest("form");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(response){document.location=response.returnUrl}})},setLanguage:function(e){var form=$(this).closest("form");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(response){document.location=response.returnUrl}})},setCurrency:function(e){var form=$(this).closest("form");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(response){document.location=response.returnUrl}})},getSelectedCurrency:function(){return $("#CurrencyCode").val()||"USD"},getSelectedMarketId:function(){return $("#MarketId").val()||"US"}};var Misc={init:function(){if(Misc.getCookie("AcceptedCookies")!=1){$(document).on("click",".jsCookies",Misc.acceptCookies);$(".jsCookies").show()}},acceptCookies:function(){Misc.setCookie("AcceptedCookies","1",365*24*60*60);$(".jsCookies").hide()},setCookie:function(cname,cvalue,exSeconds){if(!exSeconds){document.cookie=cname+"="+cvalue+"; path=/";return}var date=new Date;date.setTime(date.getTime()+exSeconds*1e3);document.cookie=cname+"="+cvalue+"; expires="+date.toUTCString()+"; path=/"},getCookie:function(cname){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1);if(c.indexOf(name)!=-1)return c.substring(name.length,c.length)}return""},updateValidation:function(formClass){var currForm=$("."+formClass);currForm.removeData("validator");currForm.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(currForm);currForm.validate()}};var Navigation={init:function(){$(".navbar").on("show.bs.collapse",function(){var actives=$(this).find(".collapse.in"),hasData;if(actives&&actives.length){hasData=actives.data("collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("collapse",null)}})}};var ProductPage={init:function(){$(document).on("change",".jsVariationSwitch",ProductPage.switchVariant);$(document).on("click",".quickview-button",ProductPage.showQuickview);ProductPage.resetCarousel();$("#product-carousel").carousel({interval:6e3});$("#carousel-thumbs").on("click","a",function(){var thumbId=$(this).attr("id");var thumbId=parseInt(thumbId);$("#product-carousel").carousel(thumbId);return false})},resetCarousel:function(){$(".carousel-inner .item").removeClass("active");$(".carousel-inner .item:first-child()").addClass("active")},switchVariant:function(){var form=$(this).closest("form");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(result){form.closest(".jsProductDetails").replaceWith($(result));ProductPage.resetCarousel();Warehouse.showWarehouseAvailability()},error:function(){$(".jsAddToCart button").addClass("disabled");alert("The variant is not available.")}})},showQuickview:function(e){e.preventDefault();var skuCode=$(this).data("sku-code");var url=$(this).data("url");$.ajax({type:"GET",cache:false,url:url,data:{entryCode:skuCode,useQuickview:true},success:function(result){$(".modal-dialog",$("#ModalDialog")).html($(result))}})}};var Recommendations={init:function(){this._bindEvents()},clickTracking:function(evt){var recommendationId=$(evt.delegateTarget).data("recommendation-id");Misc&&Misc.setCookie("EPiServer_Commerce_RecommendationId",recommendationId,60)},keyboardHandle:function(evt){if(evt.type==="keydown"&&evt.which===13||evt.type==="contextmenu"&&evt.which!==3){Recommendations.clickTracking(evt)}},render:function(returnedData,contextSettings){var data=null;try{data=JSON.parse(returnedData)}catch(e){return}var sectionMappings=contextSettings.sectionMappings;if(!(sectionMappings instanceof Array)||sectionMappings.length===0){return}var listTemplate=$("#epiRecommendationListTemplate").html(),itemTemplate=$("#epiRecommendationItemTemplate").html();Mustache.parse(listTemplate);Mustache.parse(itemTemplate);var filterRecommendation=function(recs){var filteredRecs=[];for(var i=0,length=recs.length;i<length;i++){var attributes=recs[i].attributes;if(attributes){recs[i].hasDiscount=attributes.unitPrice>attributes.salePrice;filteredRecs.push(recs[i])}}return filteredRecs};var renderRecommendations=function(data,targetArea,targetSelector,numberOfItemsToRender){var $target=$(targetSelector);if($target.length===0){return}var recs=[];if(!!data&&!!data.smartRecs){for(var i=0,length=data.smartRecs.length;i<length;i++){if(data.smartRecs[i].position===targetArea){recs=recs.concat(filterRecommendation(data.smartRecs[i].recs))}}}if(numberOfItemsToRender>0){recs=recs.slice(0,numberOfItemsToRender)}var htmlContent=Mustache.render(listTemplate,{recs:recs},{epiRecommendationItemTemplate:itemTemplate});$target.html(htmlContent)};for(var i=0,length=sectionMappings.length;i<length;i++){var targetArea=sectionMappings[i].area,targetSelector=sectionMappings[i].selector,numberOfItemsToRender=sectionMappings[i].numberOfItemsToRender;renderRecommendations(data,targetArea,targetSelector,numberOfItemsToRender)}Recommendations._bindEvents()},_bindEvents:function(){$(".recommendations").find("[data-recommendation-id]").on("click",".quick-view-btn-container > button",Recommendations.clickTracking);$(".recommendations").find("[data-recommendation-id]").on("mouseup",".product > a",Recommendations.clickTracking);$(".recommendations").find("[data-recommendation-id]").on("contextmenu",".product > a",Recommendations.keyboardHandle);$(".recommendations").find("[data-recommendation-id]").on("keydown",".product > a, .product img",Recommendations.keyboardHandle)}};var Registration={init:function(){$(document).on("submit",".jsOrderConfirmationRegistration",Registration.orderConfirmationRegistration).on("submit",".jsOrderConfirmationRegistrationAssign",Registration.orderConfirmationRegistrationAssign).on("submit",".jsRegistration",Registration.register)},register:function(e){e.preventDefault();var form=$(this).closest(".jsRegistration");$.ajax({type:"POST",url:form[0].action,data:form.serialize().replace("&Address.Region=","&Address.CountryRegion.Region="),success:function(result,status,xhr){var ct=xhr.getResponseHeader("content-type")||"";if(ct.indexOf("json")>-1){document.location=result.ReturnUrl}else{$(form).parent().replaceWith($(result))}}})},orderConfirmationRegistration:function(e){e.preventDefault();var form=$(this).closest(".jsOrderConfirmationRegistration");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(result){$(form).parent().replaceWith($(result))}})},orderConfirmationRegistrationAssign:function(e){e.preventDefault();var form=$(this).closest(".jsOrderConfirmationRegistrationAssign");$.ajax({type:"POST",url:form[0].action,data:form.serialize(),success:function(result){$(form).parent().replaceWith($(result))}})}};var Search={init:function(){$(document).on("keyup",".jsQuickSearch",Search.quickSearch).on("focus",".jsQuickSearch, .jsQuickSearchResult",Search.showResults).on("focusin.jsQuickSearchResult click.jsQuickSearchResult",function(e){if($(e.target).closest(".jsQuickSearchResult, .jsQuickSearch").length)return;$(".jsQuickSearchResult").fadeOut("medium")});$(window).bind("popstate ",function(event){Search.updatePage(location.search)});$(".js-search-input").on("focusout",function(){$(".search-input").removeClass("is-active")});$(".js-search-input").on("focusin",function(){$(".search-input").addClass("is-active")});if($(".jsSearch").length==1){Search.infinityScroll();$(document).on("change",".jsSearchSort",Search.sort).on("change",".jsSearchFacet",Search.sort).on("click",".jsSearchFacetRemoveAll",Search.removeAll)}$(".js-search-input").focus(function(){$(this).addClass("has-focus")});$(".js-search-input").blur(function(){$(this).removeClass("has-focus")})},fetchingNewPage:false,lastPage:false,lastKeyWord:"",quickSearch:function(){if($(this).val().length>1&&Search.lastKeyWord!=$(this).val()){var url=$(this).data("url");var form=$(this).closest("form");var jqXhr=$(this).data("jqXhr");if(jqXhr)jqXhr.abort();Search.lastKeyWord=$(this).val();$(this).data("jqXhr",$.ajax({type:"POST",url:url,data:form.serialize(),context:this,success:function(result){$(this).removeData("jqXhr");$(".jsQuickSearchResult").empty();$(".jsQuickSearchResult").append(result)}}))}},showResults:function(){$(".jsQuickSearchResult").show()},infinityScroll:function(){$(window).scroll(function(){if(Search.fetchingNewPage==true||Search.lastPage){return null}if($(window).scrollTop()>=$(document).height()-$(window).height()-1e3){Search.fetchingNewPage=true;var form=$(document).find(".jsSearchForm");$.ajax({url:Search.getUrlWithFacets(),type:"POST",data:form.serialize(),success:function(result){Search.fetchingNewPage=false;if($(result).find(".product").length>0){$(".jsSearchPage").replaceWith($(result).find(".jsSearchPage"));$(".jsSearch").append($(result).find(".jsSearch").children());$(".jsSearchFacets").replaceWith($(result).find(".jsSearchFacets"))}else{Search.lastPage=true}}})}})},sort:function(){Search.lastPage=false;var form=$(document).find(".jsSearchForm");$(".jsSearchPage").val(1);$(".jsSelectedFacet").val($(this).data("facetgroup")+":"+$(this).data("facetkey"));var url=Search.getUrlWithFacets();Search.updatePage(url,form.serialize(),function(){history.pushState({url:url},"",url)})},getUrlWithFacets:function(){var facets=[];$(".jsSearchFacet:input:checked").each(function(){var selectedFacet=encodeURIComponent($(this).data("facetkey"));facets.push(selectedFacet)});return Search.getUrl(facets)},getUrl:function(facets){var urlParams=Search.getUrlParams();urlParams.facets=facets?facets.join(","):null;var sort=$(".jsSearchSort")[0].value;urlParams.sort=sort;var url="?";for(var key in urlParams){var value=urlParams[key];if(value){url+=key+"="+value+"&"}}return url.slice(0,-1)},getUrlParams:function(){var match,search=/([^&=]+)=?([^&]*)/g,query=window.location.search.substring(1);var urlParams={};while(match=search.exec(query)){urlParams[match[1]]=match[2]}return urlParams},removeAll:function(){Search.lastPage=false;$(".jsSearchFacet:input:checked").each(function(){$(this).attr("checked",false)});var form=$(document).find(".jsSearchForm");$(".jsSearchPage").val(1);var url=Search.getUrl();Search.updatePage(url,form.serialize(),function(){history.pushState({url:url},"",url)})},updatePage:function(url,data,onSuccess){$.ajax({type:"POST",url:url||"",data:data,success:function(result){$(".jsSearchPage").replaceWith($(result).find(".jsSearchPage"));$(".jsSearch").replaceWith($(result).find(".jsSearch"));$(".jsSearchFacets").replaceWith($(result).find(".jsSearchFacets"));if(onSuccess){onSuccess(result)}}})}};var Warehouse={init:function(){$(document).on("click",".warehouse-quickview-button",Warehouse.showQuickview);Warehouse.showWarehouseAvailability()},showWarehouseAvailability:function(){var container=$(".warehouse-availability-container");if(container.length){var skuCode=container.data("sku-code");var url=container.data("url");$.ajax({type:"GET",cache:false,url:url,data:{skuCode:skuCode},success:function(result){container.html($(result))}})}},showQuickview:function(e){e.preventDefault();var warehouseCode=$(this).data("warehouse-code");var url=$(this).data("url");$.ajax({type:"GET",cache:false,url:url,data:{warehouseCode:warehouseCode},success:function(result){$(".modal-dialog",$("#ModalDialog")).html($(result))}})}};$(document).ready(function(){AddressBook.init();Cart.init();Checkout.init();Market.init();Misc.init();login.init();ProductPage.init();Warehouse.init();Registration.init();Search.init();Navigation.init();Recommendations.init();$("[data-hide]").on("click",function(){$(this).closest("."+$(this).attr("data-hide")).hide()})});